window.addEventListener('load',()=>{
    if(JSON.parse(localStorage.getItem('lesServicesId'))){
        window.location.href = '/dashboard';
    }
}, false);
document.getElementById('btn-cnnxion').addEventListener('click', function(){
    const email = document.getElementById('email-login');
    const pwd = document.getElementById('password-login');
    const outmess = document.getElementById('outmessage');
    const loader_cnnx = document.getElementById('loader-cnnx');
    // 
    if(!/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,6}$/.test(email.value)){
        email.classList.add('border-danger');
    }else{
        email.classList.remove('border-danger');
    }
    if(pwd.value === ''){
        pwd.classList.add('border-danger');
    }else{
        pwd.classList.remove('border-danger');
    }
    if(/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,6}$/.test(email.value) && pwd.value !== ''){
        pwd.classList.remove('border-danger');
        email.classList.remove('border-danger');
        loader_cnnx.classList.remove('d-none');
        // start connexion

        fetch('/connect/admin',{
            method: 'post',
            headers: {'content-type':'application/json'},
            body: JSON.stringify({email: email.value,password: pwd.value})
        }).then(function(res){
            loader_cnnx.classList.add('d-none');
            switch (res.status) {
                case 200:
                    const adm = JSON.parse(res.statusText);
                    localStorage.setItem('lesServicesId', JSON.stringify({nick1:adm.nick1,nick2:adm.nick2}))
                  setTimeout(function(){
                    outmess.classList.add('d-none');
                    window.location.reload()
                  }, 350)
                    break;
                case 404:
                   outmess.classList.remove('d-none');
                default:
                    break;
            }
        })
    }
}, false);
// document.getElementById('btn-enreg').addEventListener('click', function(e){
//     alert(1);
// }, false)
